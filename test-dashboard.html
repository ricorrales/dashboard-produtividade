<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Dashboard - Gr√°ficos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0a0a0f;
            color: #f8fafc;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(26, 26, 46, 0.3);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .test-button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #5855eb;
        }
        .test-result {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .test-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste Dashboard - Sistema de Gr√°ficos</h1>
        
        <div class="test-section">
            <h2>üìä Status das Depend√™ncias</h2>
            <button class="test-button" onclick="checkDependencies()">Verificar Depend√™ncias</button>
            <div id="dependencies-result"></div>
        </div>

        <div class="test-section">
            <h2>üìà Teste Chart.js</h2>
            <button class="test-button" onclick="testChartJS()">Testar Chart.js</button>
            <div id="chartjs-result"></div>
        </div>

        <div class="test-section">
            <h2>üéØ Teste Dashboard</h2>
            <button class="test-button" onclick="testDashboard()">Testar Dashboard</button>
            <button class="test-button" onclick="addTestData()">Adicionar Dados Teste</button>
            <div id="dashboard-result"></div>
        </div>

        <div class="test-section">
            <h2>üîß Comandos de Debug</h2>
            <button class="test-button" onclick="showConsoleCommands()">Mostrar Comandos</button>
            <div id="commands-result"></div>
        </div>
    </div>

    <!-- Scripts do dashboard -->
    <script>
        // Carregar Chart.js
        (function() {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js';
            script.onload = function() {
                console.log('‚úÖ Chart.js carregado para teste');
                loadDashboardScripts();
            };
            document.head.appendChild(script);
        })();

        function loadDashboardScripts() {
            // Carregar app.js
            const appScript = document.createElement('script');
            appScript.src = 'js/app.js';
            appScript.onload = function() {
                console.log('‚úÖ app.js carregado');

                // Inicializar o Dashboard manualmente, pois DOMContentLoaded j√° ocorreu
                try {
                    if (!window.dashboard && typeof ProductivityDashboard === 'function') {
                        window.dashboard = new ProductivityDashboard();
                        console.log('‚úÖ Dashboard inicializado no ambiente de teste');
                    }
                } catch (e) {
                    console.error('‚ùå Erro ao inicializar o Dashboard no teste:', e);
                }

                // Carregar charts (vers√£o simples/est√°vel)
                const chartsScript = document.createElement('script');
                chartsScript.src = 'js/charts-simple.js';
                chartsScript.onload = function() {
                    console.log('‚úÖ charts.js carregado');
                    setTimeout(() => {
                        showResult('dependencies-result', '‚úÖ Todos os scripts carregados!', false);
                    }, 1000);
                };
                document.head.appendChild(chartsScript);
            };
            document.head.appendChild(appScript);
        }

        function showResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${isError ? 'test-error' : 'test-result'}">${message}</div>`;
        }

        function checkDependencies() {
            let status = [];
            
            if (typeof Chart !== 'undefined') {
                status.push(`‚úÖ Chart.js: ${Chart.version}`);
            } else {
                status.push('‚ùå Chart.js: N√£o encontrado');
            }
            
            if (typeof window.dashboard !== 'undefined') {
                status.push(`‚úÖ Dashboard: Carregado`);
                status.push(`üìä Tarefas: ${window.dashboard.tasks?.length || 0}`);
                status.push(`‚è±Ô∏è Sess√µes: ${window.dashboard.workingSessions?.length || 0}`);
            } else {
                status.push('‚ùå Dashboard: N√£o encontrado');
            }
            
            if (typeof window.ProductivityCharts !== 'undefined') {
                status.push('‚úÖ ProductivityCharts: Dispon√≠vel');
            } else {
                status.push('‚ùå ProductivityCharts: N√£o encontrado');
            }
            
            showResult('dependencies-result', status.join('<br>'));
        }

        function testChartJS() {
            try {
                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.js n√£o est√° dispon√≠vel');
                }
                
                // Criar um gr√°fico de teste simples
                const canvas = document.createElement('canvas');
                canvas.width = 400;
                canvas.height = 200;
                
                const ctx = canvas.getContext('2d');
                const testChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar'],
                        datasets: [{
                            label: 'Teste',
                            data: [10, 20, 15],
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)'
                        }]
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Gr√°fico de Teste'
                            }
                        }
                    }
                });
                
                showResult('chartjs-result', '‚úÖ Chart.js funcionando! Gr√°fico de teste criado.');
                testChart.destroy(); // Limpar
                
            } catch (error) {
                showResult('chartjs-result', `‚ùå Erro: ${error.message}`, true);
            }
        }

        function testDashboard() {
            try {
                if (typeof window.dashboard === 'undefined') {
                    throw new Error('Dashboard n√£o est√° dispon√≠vel');
                }
                
                let status = [];
                
                // Testar m√©todos principais
                if (typeof window.dashboard.updateMetrics === 'function') {
                    status.push('‚úÖ updateMetrics: Dispon√≠vel');
                } else {
                    status.push('‚ùå updateMetrics: N√£o encontrado');
                }
                
                if (typeof window.dashboard.addTestData === 'function') {
                    status.push('‚úÖ addTestData: Dispon√≠vel');
                } else {
                    status.push('‚ùå addTestData: N√£o encontrado');
                }
                
                if (window.dashboard.charts) {
                    status.push('‚úÖ Sistema de gr√°ficos: Inicializado');
                    status.push(`üìä Gr√°ficos: ${Object.keys(window.dashboard.charts.charts || {}).length}`);
                } else {
                    status.push('‚ö†Ô∏è Sistema de gr√°ficos: N√£o inicializado');
                }
                
                showResult('dashboard-result', status.join('<br>'));
                
            } catch (error) {
                showResult('dashboard-result', `‚ùå Erro: ${error.message}`, true);
            }
        }

        function addTestData() {
            try {
                if (typeof window.addTestData === 'function') {
                    window.addTestData();
                    showResult('dashboard-result', '‚úÖ Dados de teste adicionados com sucesso!');
                } else {
                    throw new Error('Fun√ß√£o addTestData n√£o encontrada');
                }
            } catch (error) {
                showResult('dashboard-result', `‚ùå Erro: ${error.message}`, true);
            }
        }

        function showConsoleCommands() {
            const commands = [
                'window.dashboard.exportData()',
                'window.dashboard.showProductivityReport()',
                'window.addTestData()',
                'window.dashboard.clearStorage()',
                'exportAllCharts()',
                'updateCharts()',
                'debugCharts()'
            ];
            
            showResult('commands-result', 
                '<strong>Comandos dispon√≠veis no console:</strong><br>' + 
                commands.map(cmd => `<code>${cmd}</code>`).join('<br>')
            );
        }
    </script>
</body>
</html>
